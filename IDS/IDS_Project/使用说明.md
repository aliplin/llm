# IDS系统使用说明

## 快速开始

### 1. 安装依赖
```bash
pip install -r requirements.txt
```

### 2. 检查网络接口
```bash
# 检测可用的网络接口
python check_network.py
```

### 3. 运行测试
```bash
python test_system.py
```

### 4. 启动系统
```bash
# 使用启动脚本（推荐）
python start_ids.py

# 或分别启动
python app.py          # 启动Web界面
python ids_llm.py      # 启动LLM分析
```

### 5. 访问Web界面
- 地址: http://localhost:5001
- 账号: admin
- 密码: admin123

## 主要功能

### 🔍 实时监控
- **仪表盘**: 查看系统整体状态
- **事件日志**: 查看检测到的事件
- **实时监控**: 实时查看网络流量
- **LLM分析**: 查看Token使用情况和分析状态

### 🧠 LLM智能分析
- **HTTP威胁检测**: 自动检测SQL注入、XSS等Web攻击
- **SSH暴力破解检测**: 检测SSH暴力破解攻击
- **自动封禁**: 发现威胁时自动封禁恶意IP

### 💰 Token管理
- **实时监控**: 显示当前Token使用量
- **智能控制**: 达到限制时自动暂停分析
- **每日重置**: 自动重置每日使用量

## 配置说明

### 修改API密钥
编辑 `ids_llm.py` 文件：
```python
KIMI_API_KEY = "sk-1C6XrhgtvG2Y47yRYXUauXjkOHgfOLhB3WnCgSODeyHs6a5F"
```

### 网络接口配置
系统会自动检测可用的网络接口，无需手动配置。

如果需要手动指定接口，编辑 `ids_llm.py` 文件：
```python
# 在 main 函数中修改
PVM_IP_ADDRESS, interface_name = get_interface_ip('你的接口名称')
```

### 修改Token限制
编辑 `ids_llm.py` 文件：
```python
self.token_limit = 1000000  # 每日Token限制
```

## 常见问题

### Q: 提示权限错误怎么办？
A: 使用管理员权限运行：
```bash
# Windows
以管理员身份运行命令提示符，然后执行：
python start_ids.py

# Linux/Mac
sudo python start_ids.py
```

### Q: 网络接口检测失败怎么办？
A: 运行网络接口检测工具：
```bash
python check_network.py
```
根据输出结果选择合适的网络接口。

### Q: API调用失败怎么办？
A: 检查网络连接和API密钥是否正确

### Q: Token用完了怎么办？
A: 等待次日自动重置，或修改Token限制配置

### Q: 测试时某些项目失败怎么办？
A: 查看具体的错误信息：
- **网络接口失败**: 运行 `python check_network.py` 检查接口
- **API失败**: 检查网络连接和API密钥
- **权限错误**: 使用管理员权限运行

## 系统状态说明

### Token状态
- 🟢 **正常**: Token使用量在安全范围内
- 🟡 **警告**: Token使用量超过80%
- 🔴 **已超限**: 达到每日Token限制

### 威胁检测状态
- 🟢 **正常运行**: 系统正常工作
- 🔴 **检测到威胁**: 发现可疑活动
- 🟡 **需要审核**: 需要人工判断

## 日志文件

- `ids.log`: 系统运行日志
- `pending_reviews.json`: 待审核事件
- `ids.db`: 事件数据库

## 故障排除

### 1. 网络接口问题
```bash
# 检查网络接口
python check_network.py

# 如果自动检测失败，手动指定接口
# 编辑 ids_llm.py，修改 get_interface_ip() 调用
```

### 2. 权限问题
- Windows: 以管理员身份运行
- Linux/Mac: 使用 sudo 运行

### 3. 依赖问题
```bash
# 重新安装依赖
pip install -r requirements.txt

# 检查特定包
pip list | grep scapy
```

### 4. API问题
- 检查网络连接
- 验证API密钥是否正确
- 确认API配额是否充足

## 安全建议

1. 定期更换API密钥
2. 监控Token使用量
3. 定期检查系统日志
4. 及时处理检测到的威胁
5. 仅在受信任的网络环境中运行

## 调试模式

```bash
# 启用详细日志
python -u ids_llm.py

# 测试特定功能
python test_system.py
```

---

**注意**: 本系统仅用于学习和研究目的。 